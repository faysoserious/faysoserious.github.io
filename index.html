<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/series-label.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/export-data.js"></script>
    <script src="https://code.highcharts.com/modules/data.js"></script>
    <title>Hello, world!</title>
  </head>
  <body>
      <div class="container">
          <div class="row">
              <div class="col-sm-6 col-md-6">
                  <div id="container1"></div>
              </div>
              <div class="col-sm-6 col-md-6">
                  <div id = "container2"></div>
              </div>
              <div class="col-sm-6 col-md-6"></div>

          </div>
      </div>
      
<!--loading data from api-->
   <!--script type="text/javascript">

        fetch('https://scadadataapi.azurewebsites.net/api/values')
        .then(function(response) {
            return response.json();
         })
        .then(function(myJson) {
            console.log(JSON.stringify(myJson));
        });
   </script-->
   
   <script>
        var humidity = [];
        var sound = [];
        var light = [];
        var temperature = [];
       $.get('data.csv', function (csvFile) {
          var data = parseCSVData(csvFile);
         // console.log(data);
         
        //  console.log(data[2]);
        var step;
        
        for (step = 0; step < data.length; step++) {
        // Runs 5 times, with values of step 0 through 4.
            if(data[step][3]=="Humidity"){
                humidity.push(data[step]);
                
            }
            if(data[step][3]=="Sound"){
                sound.push(data[step]);
                
            }
            if(data[step][3]=="Temperature"){
                temperature.push(data[step]);
                
            }
            if(data[step][3]=="Light"){
                light.push(data[step]);
                
            }
            
        }
        console.log(sound);
        console.log(humidity);
        console.log(temperature);
        console.log(light);
        // sort by value
        humidity.sort(function (a, b) {
            return a[3] - b[3];
            
        });
        console.log(humidity);
          // create the container1
          Highcharts.chart('container1', {
                
                
                chart: {
                    type: 'scatter',
                    zoomType: 'xy'
                },
                title: {
                    text: 'Height Versus Weight of 507 Individuals by Gender'
                },
                subtitle: {
                    text: 'Source: Heinz  2003'
                },
                xAxis: {
                    title: {
                        enabled: true,
                        text: 'Height (cm)'
                    },
                    startOnTick: true,
                    endOnTick: true,
                    showLastLabel: true
                },
                yAxis: {
                    title: {
                        text: 'value'
                    }
                },
                legend: {
                    layout: 'vertical',
                    align: 'left',
                    verticalAlign: 'top',
                    x: 100,
                    y: 70,
                    floating: true,
                    backgroundColor: (Highcharts.theme && Highcharts.theme.legendBackgroundColor) || '#FFFFFF',
                    borderWidth: 1
                },
                plotOptions: {
                    scatter: {
                        marker: {
                            radius: {
                                series: [{
                                    name :'value',
                                    data: humidity[4]
                                },]
                            },
                            states: {
                                hover: {
                                    enabled: true,
                                    lineColor: 'rgb(100,100,100)'
                                }
                            }
                        },
                        states: {
                            hover: {
                                marker: {
                                    enabled: false
                                }
                            }
                        },
                        tooltip: {
                            headerFormat: '<b>{series.name}</b><br>',
                            pointFormat: '{point.x} cm, {point.y} kg'
                        }
                    }
                },
                series: [{
                    name: 'humidity',
                    color: 'rgba(223, 83, 83, .5)',
                    data: humidity

                }, ]      
            });
          // end create the chart container1

          //create container2
          Highcharts.chart('container2', {
                chart: {
                type: 'spline',
                animation: Highcharts.svg, // don't animate in old IE
                marginRight: 10,
                events: {
                    load: function () {

                        // set up the updating of the chart each second
                        var series = this.series[0];
                        setInterval(function () {
                            var x = (new Date()).getTime(), // current time
                                y = humidity[4];
                            series.addPoint([x, y], true, true);
                        }, 1000);
                    }
                }
            },

            time: {
                useUTC: false
            },

            title: {
                text: 'Live random data'
            },
            xAxis: {
                type: 'datetime',
                tickPixelInterval: 150
            },
            yAxis: {
                title: {
                    text: 'Value'
                },
                plotLines: [{
                    value: 0,
                    width: 1,
                    color: '#808080'
                }]
            },
            tooltip: {
                headerFormat: '<b>{series.name}</b><br/>',
                pointFormat: '{point.x:%Y-%m-%d %H:%M:%S}<br/>{point.y:.2f}'
            },
            legend: {
                enabled: false
            },
            exporting: {
                enabled: false
            },
            series: [{
                name: 'Random data',
                data: data
                    }]
          });
          //end create the container

       })
      
       function parseCSVData(csvFile){
           var data = [];
           var lines = csvFile.split("\n");
           $.each(lines, function(lineNumber,line){
               if(lineNumber != 0) {//skip header line

                var fields = line.split(",");
                if(fields.length == 5){ //skip invalid lines
             //       var timestamp = Date(fields[1]);
                    var floor = parseInt(fields[0]);
                    var zone = parseInt(fields[1]);
                    var type = fields[3];
                    var value = parseInt(fields[4]);
                    var timestamp = Date.parse(fields[2]);
                    data.push([floor,zone,value,type, timestamp]);
                }
               }
           });
           // reverse array Highcharts expected the data to be sorted in ascend order
           return data.reverse();
       }
   </script>
  </body>
</html>